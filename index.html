<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기상 체크 앱</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // lucide 라이브러리 로딩 확인
        window.addEventListener('load', function() {
            if (typeof lucide !== 'undefined') {
                console.log('Lucide library loaded successfully');
            } else {
                console.error('Lucide library failed to load');
            }
        });
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="login-container">
        <div class="login-card fade-in">
            <div class="logo">
                <i data-lucide="clock"></i>
            </div>
            <h1>기상 체크 앱</h1>
            
            <!-- 로그인 타입 선택 -->
            <div class="login-type-selector">
                <button class="login-type-btn active" onclick="selectLoginType('member')">
                    <i data-lucide="users"></i>
                    <span>멤버 로그인</span>
                </button>
                <button class="login-type-btn" onclick="selectLoginType('admin')">
                    <i data-lucide="shield"></i>
                    <span>관리자 로그인</span>
                </button>
            </div>
            
            <!-- 멤버 로그인 폼 -->
            <div id="memberLoginForm" class="login-form">
                <div class="input-group">
                    <input type="text" id="memberCode" placeholder="멤버 코드를 입력하세요" onkeypress="if(event.key==='Enter') handleMemberLogin()">
                </div>
                <button class="btn btn-primary" onclick="handleMemberLogin()">멤버 로그인</button>
            </div>
            
            <!-- 관리자 로그인 폼 -->
            <div id="adminLoginForm" class="login-form hidden">
                <div class="input-group">
                    <input type="text" id="adminId" placeholder="관리자 ID" onkeypress="if(event.key==='Enter') handleAdminLogin()">
                </div>
                <div class="input-group">
                    <input type="password" id="adminPassword" placeholder="비밀번호" onkeypress="if(event.key==='Enter') handleAdminLogin()">
                </div>
                <button class="btn btn-primary" onclick="handleAdminLogin()">관리자 로그인</button>
            </div>
        </div>
    </div>

    <!-- 메인 앱 -->
    <div id="appScreen" class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <i data-lucide="clock"></i>
                    <span class="header-title">기상 체크 앱</span>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userInfo">사용자님 환영합니다</span>
                    <a href="#" class="logout-btn" onclick="handleLogout()">로그아웃</a>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- 네비게이션 -->
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showPage('dashboard')">
                    <i data-lucide="bar-chart-3"></i>
                    <span>대시보드</span>
                </button>
                <button class="nav-tab" onclick="showPage('check')">
                    <i data-lucide="check-circle"></i>
                    <span>기상 체크</span>
                </button>
                <button class="nav-tab" onclick="showPage('must')">
                    <i data-lucide="calendar"></i>
                    <span>MUST 기록</span>
                </button>
                <button class="nav-tab hidden" id="adminTab" onclick="showPage('admin')">
                    <i data-lucide="settings"></i>
                    <span>관리자</span>
                </button>
            </nav>

            <!-- 대시보드 페이지 -->
            <div id="dashboardPage" class="page">
                <!-- 월별 선택 -->
                <div class="card dashboard-header-card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i data-lucide="calendar"></i>
                            월별 조회
                        </h2>
                        <div class="month-selector">
                            <select id="yearSelect" class="elegant-select">
                                <option value="2025" selected>2025년</option>
                            </select>
                            <select id="monthSelect" class="elegant-select">
                                <option value="9" selected>9월</option>
                                <option value="10">10월</option>
                                <option value="11">11월</option>
                                <option value="12">12월</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 통계 카드 -->
                <div class="stats-grid" id="statsGrid">
                    <!-- 통계 카드들이 여기에 동적으로 생성됩니다 -->
                </div>

                <!-- A. 내 월별 기상 현황 -->
                <div class="card dashboard-section-card">
                    <h3 class="card-title">
                        <i data-lucide="calendar-days"></i>
                        내 월별 기상 현황
                    </h3>
                    <div class="personal-calendar" id="personalCalendar">
                        <!-- 개인 달력이 여기에 동적으로 생성됩니다 -->
                    </div>
                </div>

                <!-- B. 멤버별 기상 현황 -->
                <div class="card dashboard-section-card">
                    <h3 class="card-title">
                        <i data-lucide="users"></i>
                        멤버별 기상 현황
                    </h3>
                    <div class="member-calendar-container">
                        <div class="calendar-header" id="memberCalendarHeader">
                            <!-- 날짜와 요일 헤더가 여기에 동적으로 생성됩니다 -->
                        </div>
                        <div class="member-calendar-grid" id="memberCalendarGrid">
                            <!-- 멤버별 기상 현황이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- C. 멤버별 점수 순위 -->
                <div class="card dashboard-section-card">
                    <h3 class="card-title">
                        <i data-lucide="trophy"></i>
                        멤버별 점수 순위
                    </h3>
                    <div class="ranking-list" id="rankingList">
                        <!-- 순위가 여기에 동적으로 생성됩니다 -->
                    </div>
                </div>
            </div>

            <!-- 기상 체크 페이지 -->
            <div id="checkPage" class="page hidden">
                <!-- 관리자용 멤버 선택 -->
                <div id="adminMemberSelect" class="card hidden">
                    <h3 class="card-title">멤버 선택</h3>
                    <div class="admin-controls">
                        <select id="checkMemberSelect" class="elegant-select">
                            <option value="">멤버를 선택하세요</option>
                        </select>
                        <input type="date" id="checkDateSelect" class="date-input">
                    </div>
                </div>

                <!-- 실시간 시계 -->
                <div class="card">
                    <h2 class="card-title">현재 시간</h2>
                    <div class="clock-display">
                        <div class="time" id="currentTime">00:00:00</div>
                        <div class="date" id="currentDate">2025년 1월 1일</div>
                    </div>
                </div>

                <!-- 오늘의 기록 -->
                <div class="card">
                    <h3 class="card-title">오늘의 기록</h3>
                    <div class="today-records">
                        <div class="record-item" id="wakeUpRecord">
                            <i data-lucide="check-circle"></i>
                            <h4>기상 체크</h4>
                            <span id="wakeUpStatus">미완료</span>
                        </div>
                        <div class="record-item" id="frogRecord">
                            <i data-lucide="award"></i>
                            <h4>개구리 잡기</h4>
                            <span id="frogStatus">미완료</span>
                        </div>
                        <div class="record-item" id="mustRecord">
                            <i data-lucide="calendar"></i>
                            <h4>MUST 기록</h4>
                            <span>MUST 탭에서 확인</span>
                        </div>
                    </div>
                </div>

                <!-- 체크 버튼들 -->
                <div class="check-buttons">
                    <div class="check-card">
                        <h4>기상 완료</h4>
                        <p>00:00 ~ 04:59 사이에만 체크 가능 (1점)</p>
                        <button class="check-btn primary" id="wakeUpBtn" onclick="handleWakeUpCheck()">
                            기상 완료!
                        </button>
                    </div>

                    <div class="check-card">
                        <h4>개구리 잡기 완료</h4>
                        <p>기상 체크 후 언제든지 가능 (1점)</p>
                        <button class="check-btn success" id="frogBtn" onclick="handleFrogCheck()">
                            개구리 잡기!
                        </button>
                    </div>
                </div>

                <!-- 가이드 -->
                <div class="guide-box">
                    <h4>점수 획득 방법</h4>
                    <ul>
                        <li>기상 완료 (00:00-04:59): 1점</li>
                        <li>개구리 잡기 (기상 체크 후): 1점</li>
                        <li>MUST 기록 (23:59까지): 1점</li>
                        <li class="highlight">하루 최대 3점까지 획득 가능!</li>
                    </ul>
                </div>
            </div>

            <!-- MUST 기록 페이지 -->
            <div id="mustPage" class="page hidden">
                <!-- MUST 탭 네비게이션 -->
                <div class="must-tabs">
                    <button class="must-tab active" onclick="switchMustTab('creation')">
                        MUST/개구리 작성
                    </button>
                    <button class="must-tab" onclick="switchMustTab('record')">
                        MUST 기록
                    </button>
                </div>

                <!-- MUST/개구리 작성 탭 -->
                <div id="mustCreationTab" class="must-tab-content">
                    <h2 class="main-title">MUST / 개구리 작성</h2>
                    
                    <!-- 내일 우선순위 MUST 5가지 -->
                    <div class="card must-card">
                        <h3 class="section-title">📋 내일 우선순위 MUST 5가지</h3>
                        <div class="must-inputs">
                            <input type="text" id="must1" placeholder="MUST 1" class="must-input">
                            <input type="text" id="must2" placeholder="MUST 2" class="must-input">
                            <input type="text" id="must3" placeholder="MUST 3" class="must-input">
                            <input type="text" id="must4" placeholder="MUST 4" class="must-input">
                            <input type="text" id="must5" placeholder="MUST 5" class="must-input">
                        </div>
                    </div>

                    <!-- 개구리 3가지 -->
                    <div class="card must-card">
                        <h3 class="section-title">🐸 개구리 3가지</h3>
                        <div class="frog-inputs">
                            <input type="text" id="frog1" placeholder="개구리 1" class="must-input">
                            <input type="text" id="frog2" placeholder="개구리 2" class="must-input">
                            <input type="text" id="frog3" placeholder="개구리 3" class="must-input">
                        </div>
                    </div>

                    <!-- 하루 복기 -->
                    <div class="card must-card">
                        <h3 class="card-title">하루 복기</h3>
                        <textarea 
                            id="dailyReview" 
                            class="daily-review-textarea" 
                            placeholder="오늘 하루를 돌아봅니다."
                        ></textarea>
                    </div>

                    <!-- 액션 버튼 -->
                    <div class="must-action-buttons">
                        <button class="btn btn-secondary" onclick="copyMustCreation()">
                            복사
                        </button>
                        <button class="btn btn-primary" onclick="saveMustCreation()">
                            저장
                        </button>
                    </div>
                </div>

                <!-- MUST 기록 탭 -->
                <div id="mustRecordTab" class="must-tab-content hidden">
                    <h2 class="main-title">MUST 기록</h2>
                    
                    <!-- 관리자용 멤버 선택 -->
                    <div id="adminMustMemberSelect" class="card hidden">
                        <h3 class="card-title">멤버 선택</h3>
                        <div class="admin-controls">
                            <select id="mustMemberSelect" class="elegant-select">
                                <option value="">멤버를 선택하세요</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 날짜 선택 -->
                    <div class="card date-selection-card">
                        <h3 class="card-title">날짜 선택</h3>
                        <div class="date-picker">
                            <input type="date" id="recordDatePicker" class="date-input" onchange="loadMustRecord()">
                        </div>
                    </div>

                    <!-- 선택된 날짜의 기록 -->
                    <div class="card record-display-card">
                        <h3 class="card-title">
                            <span id="selectedDateTitle">선택된 날짜</span>
                        </h3>
                        <div id="recordDisplay" class="record-display">
                            <div class="no-record-message">
                                날짜를 선택하면 해당 날짜의 기록이 표시됩니다.
                            </div>
                        </div>
                    </div>

                    <!-- 안내 메시지 -->
                    <div class="guide-box">
                        <p style="color: #f57c00; margin: 0;">
                            💡 <strong>안내:</strong> 23:59까지 MUST 기록을 완료하시면 1점을 획득할 수 있습니다.
                        </p>
                    </div>
                </div>
            </div>

            <!-- 관리자 페이지 -->
            <div id="adminPage" class="page hidden">
                <!-- 멤버 추가 -->
                <div class="card">
                    <h2 class="card-title">새 멤버 추가</h2>
                    
                    <div class="admin-form">
                        <input type="text" id="newMemberName" placeholder="멤버 이름">
                        <input type="text" id="newMemberCode" placeholder="멤버 코드 (예: WAKE004)">
                        <button class="btn btn-primary" onclick="addMember()">
                            <i data-lucide="user-plus"></i> 추가
                        </button>
                    </div>
                </div>

                <!-- 멤버 코드 추가 -->
                <div class="card">
                    <h2 class="card-title">멤버 코드 추가</h2>
                    
                    <div class="admin-form">
                        <select id="existingMemberSelect" class="elegant-select">
                            <option value="">멤버를 선택하세요</option>
                        </select>
                        <input type="text" id="newMemberCodeForExisting" placeholder="새 멤버 코드">
                        <button class="btn btn-secondary" onclick="addMemberCode()">
                            <i data-lucide="key"></i> 코드 추가
                        </button>
                    </div>
                </div>

                <!-- 멤버 목록 -->
                <div class="card">
                    <h3 class="card-title">등록된 멤버</h3>
                    <div class="member-list" id="memberList">
                        <!-- 멤버 목록이 여기에 동적으로 생성됩니다 -->
                    </div>
                </div>

                <!-- 멤버 삭제 -->
                <div class="card">
                    <h3 class="card-title">멤버 삭제</h3>
                    <div class="admin-form">
                        <select id="deleteMemberSelect" class="elegant-select">
                            <option value="">삭제할 멤버 선택</option>
                        </select>
                        <button class="btn btn-danger" onclick="deleteMember()">
                            <i data-lucide="user-minus"></i> 삭제
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
